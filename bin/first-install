#!/bin/bash

set -e
DIR=$(dirname "$(realpath "$BASH_SOURCE")")
source "$DIR/.common"
cd "$DIR/.."

LOCK="install.lock"

echo "Checking for $PS_FOLDER_INSTALL dir..."

if [ -e $PS_FOLDER_INSTALL -a -d $PS_FOLDER_INSTALL ]
    then
        echo "Launching the installer script. Installation might take a litle while..."
        cmd php /var/www/html/$PS_FOLDER_INSTALL/index_cli.php \
        --domain="$PS_DOMAIN" --db_server=$DB_SERVER:$DB_PORT --db_name="$DB_NAME" --db_user=$DB_USER \
        --db_password=$DB_PASSWD --prefix="$DB_PREFIX" --firstname="Henri" --lastname="Baeyens" \
        --password="$ADMIN_PASSWD" --email="$ADMIN_MAIL" --language=$PS_LANGUAGE --country=$PS_COUNTRY \
        --all_languages=$PS_ALL_LANGUAGES --newsletter=0 --send_email=0 --ssl=$PS_ENABLE_SSL

        echo "Removing install folder..."
        cmd rm -Rf $PS_FOLDER_INSTALL
        echo "Setup completed."
        if [ -e $LOCK -a -f $LOCK ]
            then
                echo "Removing lock file..."
                cmd rm $LOCK
        fi
else
    echo "Install folder not found.";
fi


